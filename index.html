<html>
<head>
<meta charset="utf-8">
<title>Magic Website Redirect</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0">
<script type="text/javascript" src="./hashids.min.js"></script>
</head>
<body>
<p><input type="text" id="txt_url"></p>
<p><button id="btn_create">生成</button></p>
<p id="txt_result"></p>
<script type="text/javascript">
'use strict';
(function(){
	let conf = {token:"DHqE9tpKjfyAmnPdjUWwDE"};
	let hashData = location.hash.substr(1);
	let txt_url = document.getElementById('txt_url');
	let txt_result = document.getElementById('txt_result');
	document.getElementById('btn_create').addEventListener('click',_=>{
		let code = getRandom();
		fetch("https://kvdb.io/" + conf.token + "/url_" + code, {
			'method': 'POST', 'body': txt_url.value
		}).then(r => {
			let url = location.toString();
			if(url.indexOf('#')!==-1) url = url.substr(0,url.indexOf('#'));
			url += '#' + code;
			txt_result.innerHTML = `<a href="${url}">${url}</a>`;
		});
	});
	window.addEventListener('hashchange', function (e) {
		loadContent();
	});
	function loadContent(){
		if(hashData){
			fetch("https://kvdb.io/" + conf.token + "/url_" + hashData)
				.then(r => r.text()).then(r => {
					location.href = r;
			});
		}
	}
	function getRandom(){
		return Math.random().toString(32).substring(2, 5) + Math.random().toString(32).substring(2, 5);
	}
})();
</script>
</body>
</html>
