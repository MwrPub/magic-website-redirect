<html>
<head>
<meta charset="utf-8">
<title>Magic Website Redirect</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0">
</head>
<body>
<div id="container" style="display:none;">
<h3>短链接生成器</h3>
<p><input type="text" id="txt_url" placeholder="输入网址"></p>
<p><button id="btn_create">生成</button></p>
<p id="txt_result"></p>
</div>
<script type="text/javascript">
'use strict';
(function(){
	let conf = {token:"DHqE9tpKjfyAmnPdjUWwDE"};
	let txt_url = document.getElementById('txt_url');
	let txt_result = document.getElementById('txt_result');
	document.getElementById('btn_create').addEventListener('click',_=>{
		let text_in = txt_url.value;
		if(text_in.startsWith("https://") || text_in.startsWith("http://")){
			let code = getRandom();
			fetch("https://kvdb.io/" + conf.token + "/url_" + code, {
				'method': 'POST', 'body': txt_url.value
			}).then(r => {
				let url = "https://mwr.pub/u/";
				url += '#' + code;
				txt_result.innerHTML = `<a href="${url}">${url}</a>`;
			});
		}else{
			window.alert("请输入网址~");
		}
	});
	window.addEventListener('hashchange', function (e) {
		loadContent();
	});
	function loadContent(){
		let hashData = location.hash.substr(1);
		if(hashData){
			fetch("https://kvdb.io/" + conf.token + "/url_" + hashData)
				.then(r => r.text()).then(r => {
					location.href = r;
			});
		}else{
			document.getElementById('container').style.display="block";
		}
	}
	function getRandom(){
		return Math.random().toString(32).substring(2, 5) + Math.random().toString(32).substring(2, 5);
	}
	loadContent();
})();
</script>
</body>
</html>
